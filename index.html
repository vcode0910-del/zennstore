<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenn Storee - Cloud Professional Store</title>
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb; --primary-hover: #1d4ed8; --bg: #f8fafc;
            --card: #ffffff; --text: #0f172a; --text-muted: #64748b;
            --border: #e2e8f0; --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg: #020617; --card: #0f172a; --text: #f1f5f9;
            --text-muted: #94a3b8; --border: #1e293b;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: background 0.3s, color 0.3s; }
        body { background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; }

        /* Loader - FIX: pointer-events none agar tidak menghalangi tombol */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
            transition: 0.5s; pointer-events: all; 
        }
        #loader.hidden { opacity: 0; pointer-events: none; }

        /* Navigation */
        nav {
            background: var(--card); padding: 15px 5%; display: flex; 
            justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border);
        }
        .logo { font-size: 1.6rem; font-weight: 800; color: var(--primary); text-decoration: none; }

        /* Container */
        .container { max-width: 1200px; margin: auto; padding: 40px 5%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }

        /* Card Produk */
        .card-prod {
            background: var(--card); border-radius: 24px; overflow: hidden; border: 1px solid var(--border);
            transition: 0.4s; position: relative;
        }
        .card-prod:hover { transform: translateY(-10px); box-shadow: var(--shadow); }
        .card-img { width: 100%; height: 210px; object-fit: cover; background: #eee; }
        .card-body { padding: 22px; }
        .price-tag { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin: 10px 0; }

        /* Button Modern */
        .btn-main {
            width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700; 
            cursor: pointer; background: var(--primary); color: white; display: block;
            text-align: center; text-decoration: none; font-size: 0.95rem;
        }
        .btn-main:hover { background: var(--primary-hover); transform: scale(1.02); }
        .btn-main:active { transform: scale(0.95); }

        /* Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 2000;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content {
            background: var(--card); padding: 35px; border-radius: 30px; width: 100%; 
            max-width: 500px; border: 1px solid var(--border); position: relative;
        }

        input {
            width: 100%; padding: 14px; margin-bottom: 15px; border-radius: 12px;
            border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none;
        }

        .admin-float { position: fixed; bottom: 25px; right: 25px; width: 55px; height: 55px; background: var(--primary); color: white; border-radius: 18px; border: none; cursor: pointer; z-index: 1500; }
    </style>
</head>
<body data-theme="light">

    <!-- Loader -->
    <div id="loader">
        <i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--primary)"></i>
        <p style="margin-top:20px; font-weight:800;">ZENN CLOUD CONNECTING...</p>
    </div>

    <!-- NAVBAR -->
    <nav>
        <a href="#" class="logo">ZENN<span>STOREE</span></a>
        <button onclick="toggleTheme()" style="background:none; border:none; color:var(--text); font-size:1.2rem; cursor:pointer;"><i class="fas fa-moon" id="themeIcon"></i></button>
    </nav>

    <!-- MAIN -->
    <div class="container">
        <header style="text-align: center; margin-bottom: 50px;" data-aos="fade-up">
            <h1>Game Store <span>Cloud</span></h1>
            <p style="color:var(--text-muted)">Top Up Otomatis & Joki Profesional Real-Time.</p>
        </header>

        <div class="grid" id="mainGrid">
            <!-- Produk Muncul Di Sini -->
        </div>
    </div>

    <!-- MODAL ORDER -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <h2 id="orderTitle">Detail Order</h2>
            <div style="margin: 20px 0;">
                <label style="font-size: 0.8rem; font-weight: 700;">USER ID / DATA TARGET</label>
                <input type="text" id="targetId" placeholder="Contoh: 12345678 (Server)">
                
                <div style="background:var(--bg); padding:20px; border-radius:20px; border:1px dashed var(--border); text-align:center;">
                    <p style="font-size:0.8rem; margin-bottom:5px;">TOTAL PEMBAYARAN:</p>
                    <h2 id="finalPrice" style="color:var(--primary)">Rp 0</h2>
                </div>
            </div>

            <button class="btn-main" onclick="confirmOrder()">Pesan Sekarang (WA)</button>
            <button class="btn-main" style="background:none; color:var(--text-muted); margin-top:10px;" onclick="closeModal()">Batal</button>
        </div>
    </div>

    <button class="admin-float" onclick="openAdmin()"><i class="fas fa-shield-alt"></i></button>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();

        // --- KONFIGURASI SUPABASE ---
        const SB_URL = "https://supjhhgcnqqxdkzsvykq.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1cGpoaGdjbnFxeGRrenN2eWtxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NjczNDQsImV4cCI6MjA4NTI0MzM0NH0.UtP06HT6V8X5M_IY2BCixrz0VNwDsNAZiDK8NgSfcgw";

        let _supabase;
        let prods = [];
        let selectedIdx = null;

        // Inisialisasi
        try {
            _supabase = supabase.createClient(SB_URL, SB_KEY);
        } catch(e) { console.error("Koneksi Supabase Gagal"); }

        // Load Data Produk
        async function fetchCloud() {
            setLoad(true);
            try {
                const { data, error } = await _supabase.from('products').select('*');
                if (error) throw error;
                prods = data || [];
                renderGrid(prods);
            } catch (err) {
                console.error("Error memuat data:", err.message);
                document.getElementById('mainGrid').innerHTML = "<p>Gagal memuat produk. Cek koneksi.</p>";
            } finally {
                setLoad(false);
            }
        }

        function renderGrid(data) {
            const grid = document.getElementById('mainGrid');
            if(data.length === 0) {
                grid.innerHTML = `<p style="text-align:center; grid-column:1/-1;">Belum ada produk di database.</p>`;
                return;
            }
            grid.innerHTML = data.map((p, i) => `
                <div class="card-prod" data-aos="fade-up">
                    <img src="${p.img || 'https://via.placeholder.com/300'}" class="card-img">
                    <div class="card-body">
                        <h3 style="margin-bottom:5px;">${p.name}</h3>
                        <p style="font-size:0.7rem; color:var(--text-muted); margin-bottom:10px;">${p.cat || 'Game'}</p>
                        <p class="price-tag">Rp ${parseInt(p.price).toLocaleString()}</p>
                        <button class="btn-main" onclick="openOrder(${i})">Beli Sekarang</button>
                    </div>
                </div>
            `).join('');
        }

        // Fungsi Beli (Buka Modal)
        function openOrder(idx) {
            console.log("Membuka produk indeks:", idx); // Cek di console (F12)
            selectedIdx = idx;
            const p = prods[idx];
            document.getElementById('orderTitle').innerText = p.name;
            document.getElementById('finalPrice').innerText = `Rp ${parseInt(p.price).toLocaleString()}`;
            document.getElementById('orderModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('orderModal').style.display = 'none';
        }

        function confirmOrder() {
            const target = document.getElementById('targetId').value;
            if(!target) return alert("Masukkan ID Game Anda!");
            const p = prods[selectedIdx];
            const wa = `https://api.whatsapp.com/send?phone=628123456789&text=*ORDER ZENN STOREE*%0AProduk: ${p.name}%0ATarget: ${target}%0AHarga: Rp ${parseInt(p.price).toLocaleString()}`;
            window.open(wa);
        }

        // Utilities
        function setLoad(isLoading) {
            const loader = document.getElementById('loader');
            if(!isLoading) {
                loader.classList.add('hidden');
            } else {
                loader.classList.remove('hidden');
            }
        }

        function toggleTheme() {
            const body = document.body;
            const isDark = body.getAttribute('data-theme') === 'dark';
            body.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeIcon').className = isDark ? 'fas fa-moon' : 'fas fa-sun';
        }

        function openAdmin() {
            const p = prompt("Password Admin:");
            if(p === "admin123") alert("Admin diakses via Supabase Table Editor.");
        }

        // Start
        window.onload = fetchCloud;

        // Safety Hide Loader (Jika internet lemot, loader paksa hilang dalam 4 detik)
        setTimeout(() => setLoad(false), 4000);
    </script>
</body>
</html>
