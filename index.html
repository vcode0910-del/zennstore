<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenn Storee - Cloud Professional Store</title>
    
    <!-- Library Eksternal -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb; --primary-hover: #1d4ed8; --bg: #f8fafc;
            --card: #ffffff; --text: #0f172a; --text-muted: #64748b;
            --border: #e2e8f0; --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg: #020617; --card: #0f172a; --text: #f1f5f9;
            --text-muted: #94a3b8; --border: #1e293b;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: background 0.3s, color 0.3s, transform 0.2s; }
        body { background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; }

        /* Navigation */
        nav {
            background: var(--card); padding: 15px 5%; display: flex; 
            justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border);
        }
        .logo { font-size: 1.6rem; font-weight: 800; color: var(--primary); text-decoration: none; letter-spacing: -1px; }
        .logo span { color: var(--text); }

        .nav-tools { display: flex; align-items: center; gap: 12px; }

        /* Buttons */
        .btn-circle {
            width: 42px; height: 42px; border-radius: 50%; border: 1px solid var(--border);
            background: var(--card); color: var(--text); cursor: pointer;
            display: flex; align-items: center; justify-content: center; font-size: 1.1rem;
        }
        .btn-circle:hover { background: var(--primary); color: white; transform: rotate(15deg); }

        .btn-main {
            padding: 12px 24px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer;
            display: flex; align-items: center; gap: 8px; font-size: 0.9rem; justify-content: center;
            background: var(--primary); color: white;
        }
        .btn-main:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 5px 15px rgba(37,99,235,0.4); }

        /* Hero */
        .container { max-width: 1200px; margin: auto; padding: 40px 5%; }
        .hero { text-align: center; padding: 40px 0; }
        .hero h1 { font-size: clamp(2.2rem, 5vw, 3.5rem); font-weight: 800; margin-bottom: 10px; }
        .hero h1 span { color: var(--primary); }

        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 40px; justify-content: center; flex-wrap: wrap; }
        .tab-btn {
            padding: 10px 22px; border-radius: 30px; border: 1px solid var(--border);
            background: var(--card); color: var(--text); cursor: pointer; font-weight: 600;
        }
        .tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

        /* Product Grid */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
        .card-prod {
            background: var(--card); border-radius: 24px; overflow: hidden; border: 1px solid var(--border);
            position: relative; transition: 0.4s;
        }
        .card-prod:hover { transform: translateY(-10px); box-shadow: var(--shadow); }
        .card-img { width: 100%; height: 210px; object-fit: cover; background: #eee; }
        .card-body { padding: 22px; }
        .price-tag { font-size: 1.5rem; font-weight: 800; color: var(--primary); margin: 10px 0; }

        /* Modal */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); z-index: 2000;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content {
            background: var(--card); padding: 35px; border-radius: 30px; width: 100%; max-width: 500px;
            max-height: 90vh; overflow-y: auto; border: 1px solid var(--border); position: relative;
        }
        .input-box {
            width: 100%; padding: 14px; margin-bottom: 15px; border-radius: 12px;
            border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none;
        }

        /* Loader */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 9999;
        }

        /* Admin Float */
        .admin-btn {
            position: fixed; bottom: 25px; right: 25px; width: 55px; height: 55px;
            background: var(--primary); color: white; border-radius: 18px; border: none;
            cursor: pointer; box-shadow: 0 8px 20px rgba(37,99,235,0.3); z-index: 900;
        }
    </style>
</head>
<body data-theme="light">

    <!-- Loader -->
    <div id="loader">
        <i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--primary)"></i>
        <p style="margin-top:20px; font-weight:800; letter-spacing: 1px;">ZENN STOREE CLOUD...</p>
    </div>

    <!-- NAVBAR -->
    <nav>
        <a href="#" class="logo">ZENN<span>STOREE</span></a>
        <div class="nav-tools">
            <button class="btn-circle" onclick="toggleTheme()" id="themeBtn"><i class="fas fa-moon"></i></button>
            <div style="position: relative;">
                <button class="btn-circle" onclick="toggleDrop()"><i class="fas fa-ellipsis-v"></i></button>
                <div id="dropMenu" style="display:none; position:absolute; right:0; top:50px; background:var(--card); border:1px solid var(--border); border-radius:12px; width:180px; box-shadow:var(--shadow); overflow:hidden; z-index:1100;">
                    <button style="width:100%; padding:12px; text-align:left; background:none; border:none; color:var(--text); cursor:pointer;" onclick="alert('Belum ada riwayat')">History</button>
                    <button style="width:100%; padding:12px; text-align:left; background:none; border:none; color:var(--text); cursor:pointer;" onclick="window.open('https://wa.me/628123456789')">Hubungi Admin</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- CONTENT -->
    <div class="container">
        <header class="hero" data-aos="zoom-out">
            <h1>Game Store <span>Cloud</span></h1>
            <p style="color:var(--text-muted)">Top Up Otomatis & Joki Profesional. Aman & Terpercaya.</p>
        </header>

        <div class="tabs" data-aos="fade-up">
            <button class="tab-btn active" onclick="filterCat('all')">Semua</button>
            <button class="tab-btn" onclick="filterCat('Top Up')">Top Up</button>
            <button class="tab-btn" onclick="filterCat('Joki')">Joki</button>
            <button class="tab-btn" onclick="filterCat('Items')">Items</button>
        </div>

        <div class="grid" id="mainGrid">
            <!-- Produk akan muncul otomatis di sini -->
        </div>
    </div>

    <!-- MODAL ORDER -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <h2 id="orderTitle">Order</h2>
            <p id="orderDesc" style="color:var(--text-muted); font-size:0.85rem; margin-bottom:20px;"></p>
            
            <input type="text" id="targetId" class="input-box" placeholder="User ID / Target Game">
            
            <div style="display:flex; gap:10px;">
                <input type="text" id="promoInp" class="input-box" placeholder="Kode Promo">
                <button class="btn-main" style="height:48px; width:100px;" onclick="applyPromo()">Cek</button>
            </div>

            <div style="background:var(--bg); padding:25px; border-radius:20px; border:2px dashed var(--border); text-align:center; margin-bottom:20px;">
                <p style="font-size:0.8rem; margin-bottom:10px;">TOTAL PEMBAYARAN:</p>
                <h2 id="finalPrice" style="color:var(--primary)">Rp 0</h2>
                <p id="discountTxt" style="color:green; font-weight:800; font-size:0.85rem; margin-top:5px;"></p>
            </div>

            <button class="btn-main" style="width:100%" onclick="confirmOrder()">Pesan Sekarang (WA)</button>
            <button class="btn-main" style="width:100%; background:none; color:var(--text-muted); margin-top:10px;" onclick="closeModal('orderModal')">Kembali</button>
        </div>
    </div>

    <!-- ADMIN MODAL -->
    <div id="adminModal" class="modal">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>Admin Panel</h2>
                <button class="btn-circle" onclick="closeModal('adminModal')"><i class="fas fa-times"></i></button>
            </div>
            <input type="text" id="p_name" class="input-box" placeholder="Nama Produk">
            <select id="p_cat" class="input-box"><option>Top Up</option><option>Joki</option><option>Items</option></select>
            <input type="number" id="p_price" class="input-box" placeholder="Harga (Angka saja)">
            <textarea id="p_desc" class="input-box" placeholder="Deskripsi Singkat"></textarea>
            <label style="font-size:0.7rem; display:block; margin-bottom:5px;">Foto Produk:</label>
            <input type="file" id="p_img" class="input-box" accept="image/*">
            <button class="btn-main" style="width:100%" onclick="adminUpload()">Unggah Produk ke Cloud</button>
        </div>
    </div>

    <button class="admin-btn" onclick="openAdmin()"><i class="fas fa-shield-alt"></i></button>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();

        // --- KONFIGURASI SUPABASE ---
        const SB_URL = "https://supjhhgcnqqxdkzsvykq.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1cGpoaGdjbnFxeGRrenN2eWtxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NjczNDQsImV4cCI6MjA4NTI0MzM0NH0.UtP06HT6V8X5M_IY2BCixrz0VNwDsNAZiDK8NgSfcgw";

        let _supabase;
        let allProds = [];
        let selectedIdx = null;
        let finalDiscount = 0;

        // Inisialisasi
        try {
            _supabase = supabase.createClient(SB_URL, SB_KEY);
        } catch(e) { console.error("Database connection failed"); }

        // Load Data
        async function fetchCloud() {
            setLoad(true);
            try {
                const { data, error } = await _supabase.from('products').select('*');
                if (error) throw error;
                allProds = data || [];
                renderGrid(allProds);
            } catch (err) {
                console.error("Fetch error:", err.message);
            } finally {
                setLoad(false);
            }
        }

        function renderGrid(data) {
            const grid = document.getElementById('mainGrid');
            if(data.length === 0) {
                grid.innerHTML = `<p style="text-align:center; grid-column:1/-1; opacity:0.5;">Belum ada produk di database cloud.</p>`;
                return;
            }
            grid.innerHTML = data.map((p, i) => `
                <div class="card-prod" data-aos="fade-up">
                    <img src="${p.img || 'https://via.placeholder.com/300'}" class="card-img">
                    <div class="card-body">
                        <h3>${p.name}</h3>
                        <p style="font-size:0.75rem; color:var(--text-muted);">${p.cat}</p>
                        <p class="price-tag">Rp ${parseInt(p.price).toLocaleString()}</p>
                        <button class="btn-main" onclick="openOrder(${i})">Beli Sekarang</button>
                    </div>
                </div>
            `).join('');
        }

        function filterCat(cat) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            const filtered = cat === 'all' ? allProds : allProds.filter(p => p.cat === cat);
            renderGrid(filtered);
        }

        // Order
        function openOrder(idx) {
            selectedIdx = idx;
            const p = allProds[idx];
            finalDiscount = 0;
            document.getElementById('orderTitle').innerText = p.name;
            document.getElementById('orderDesc').innerText = p.desc || '';
            document.getElementById('finalPrice').innerText = `Rp ${parseInt(p.price).toLocaleString()}`;
            document.getElementById('promoStatus').innerText = "";
            document.getElementById('discountTxt').innerText = "";
            openModal('orderModal');
        }

        async function applyPromo() {
            const code = document.getElementById('promoInp').value.toUpperCase();
            if(!code) return;
            const { data } = await _supabase.from('promos').select('*').eq('code', code).eq('active', true).single();
            if(data) {
                const p = allProds[selectedIdx];
                finalDiscount = data.discount_type === 'PERCENT' ? (p.price * data.discount_value / 100) : data.discount_value;
                document.getElementById('finalPrice').innerText = `Rp ${(p.price - finalDiscount).toLocaleString()}`;
                document.getElementById('discountTxt').innerText = `Potongan: Rp ${finalDiscount.toLocaleString()}`;
            } else alert("Kode Promo tidak valid");
        }

        function confirmOrder() {
            const target = document.getElementById('targetId').value;
            if(!target) return alert("Isi Target!");
            const p = allProds[selectedIdx];
            const wa = `https://api.whatsapp.com/send?phone=628123456789&text=*ORDER ZENN STOREE*%0AProduk: ${p.name}%0ATarget: ${target}%0ATotal: Rp ${(p.price - finalDiscount).toLocaleString()}`;
            window.open(wa);
        }

        // Admin
        async function adminUpload() {
            const name = document.getElementById('p_name').value;
            const cat = document.getElementById('p_cat').value;
            const price = document.getElementById('p_price').value;
            const desc = document.getElementById('p_desc').value;
            const file = document.getElementById('p_img').files[0];

            if(!name || !file) return alert("Isi data produk!");

            setLoad(true);
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async () => {
                await _supabase.from('products').insert([{ name, cat, price, desc, img: reader.result }]);
                location.reload();
            };
        }

        // Utils
        function setLoad(s) { 
            const l = document.getElementById('loader');
            if(!s) {
                l.style.opacity = '0';
                setTimeout(() => l.style.display = 'none', 500);
            } else { l.style.display = 'flex'; l.style.opacity = '1'; }
        }
        function toggleTheme() {
            const now = document.body.getAttribute('data-theme');
            const target = now === 'light' ? 'dark' : 'light';
            document.body.setAttribute('data-theme', target);
            localStorage.setItem('zenn_theme', target);
            document.getElementById('themeBtn').innerHTML = target === 'light' ? '<i class="fas fa-moon"></i>' : '<i class="fas fa-sun"></i>';
        }
        function toggleDrop() { const m = document.getElementById('dropMenu'); m.style.display = m.style.display === 'block' ? 'none' : 'block'; }
        function openAdmin() {
            const p = prompt("Password Admin:");
            if(p === "admin123") openModal('adminModal');
        }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }

        // Start
        window.onload = () => {
            const saved = localStorage.getItem('zenn_theme') || 'light';
            document.body.setAttribute('data-theme', saved);
            fetchCloud();
        };

        // Safety timeout
        setTimeout(() => setLoad(false), 5000);
    </script>
</body>
</html>
