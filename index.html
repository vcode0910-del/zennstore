<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zenn Storee | Premium Gaming Hub</title>
    
    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #2563eb; --primary-hover: #1d4ed8; --bg: #f8fafc;
            --card: #ffffff; --text: #0f172a; --text-muted: #64748b;
            --border: #e2e8f0; --shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --bg: #020617; --card: #0f172a; --text: #f1f5f9;
            --text-muted: #94a3b8; --border: #1e293b;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Plus Jakarta Sans', sans-serif; transition: all 0.3s ease; }
        body { background: var(--bg); color: var(--text); line-height: 1.6; overflow-x: hidden; }

        /* Loader */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10000;
        }

        /* FULL OVERLAY SYSTEM */
        #fullOverlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(12px);
            z-index: 9000; justify-content: center; align-items: center; padding: 20px;
        }
        .overlay-card {
            background: var(--card); padding: 40px; border-radius: 30px;
            max-width: 500px; width: 100%; text-align: center;
            box-shadow: var(--shadow); border: 1px solid var(--border);
            transform: scale(0.8); opacity: 0; transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        #fullOverlay.active .overlay-card { transform: scale(1); opacity: 1; }
        .overlay-img { width: 100%; border-radius: 20px; margin-bottom: 20px; box-shadow: var(--shadow); }

        /* Navigation */
        nav {
            background: var(--card); padding: 15px 7%; display: flex; 
            justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border);
        }
        .logo { font-size: 1.6rem; font-weight: 800; color: var(--primary); text-decoration: none; }

        /* Grid & Cards */
        .container { max-width: 1200px; margin: auto; padding: 40px 7%; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; }
        .card-prod {
            background: var(--card); border-radius: 24px; overflow: hidden; border: 1px solid var(--border);
            transition: 0.4s; position: relative;
        }
        .card-prod:hover { transform: translateY(-10px); box-shadow: var(--shadow); }
        .card-img { width: 100%; height: 210px; object-fit: cover; }
        .price { font-size: 1.5rem; font-weight: 800; color: var(--primary); }

        /* Input & Buttons */
        .btn-main {
            width: 100%; padding: 14px; border-radius: 12px; border: none; font-weight: 700;
            cursor: pointer; background: var(--primary); color: white; display: block; text-align: center;
        }
        .btn-main:hover { background: var(--primary-hover); transform: scale(1.02); }
        input, select { width: 100%; padding: 14px; margin-bottom: 15px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg); color: var(--text); outline: none; }

        /* Admin Float */
        .admin-float { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--primary); color: white; border-radius: 20px; border: none; cursor: pointer; z-index: 2000; box-shadow: var(--shadow); }
        
        /* Modal General */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5); backdrop-filter: blur(8px); z-index: 8000;
            justify-content: center; align-items: center; padding: 20px;
        }
        .modal-content { background: var(--card); padding: 35px; border-radius: 30px; width: 100%; max-width: 500px; }
    </style>
</head>
<body data-theme="light">

    <!-- LOADER -->
    <div id="loader"><i class="fas fa-circle-notch fa-spin fa-3x" style="color:var(--primary)"></i></div>

    <!-- FULL OVERLAY SYSTEM -->
    <div id="fullOverlay">
        <div class="overlay-card">
            <img id="ovImg" src="" class="overlay-img" alt="Promo">
            <h2 id="ovTitle" style="margin-bottom: 10px;">Pengumuman</h2>
            <p id="ovDesc" style="color: var(--text-muted); margin-bottom: 25px;">Selamat datang di Zenn Storee!</p>
            <button class="btn-main" onclick="closeOverlay()">Mulai Belanja</button>
        </div>
    </div>

    <!-- NAVBAR -->
    <nav>
        <a href="#" class="logo">ZENN<span>STOREE</span></a>
        <div style="display: flex; align-items: center; gap: 15px;">
            <button onclick="toggleTheme()" class="btn-main" style="width: auto; padding: 8px 12px; background: var(--border); color: var(--text); border: none;"><i class="fas fa-moon" id="themeIcon"></i></button>
            <button onclick="openModal('trackModal')" style="background:none; border:none; color:var(--text); cursor:pointer; font-size: 1.2rem;"><i class="fas fa-search-location"></i></button>
        </div>
    </nav>

    <div class="container">
        <header style="text-align: center; margin-bottom: 50px;" data-aos="fade-up">
            <h1>Game Hub <span>Premium</span></h1>
            <p style="color: var(--text-muted);">Layanan Top Up & Joki Tercepat dengan Sistem Cloud.</p>
        </header>

        <div class="grid" id="mainGrid"></div>
    </div>

    <!-- MODAL ORDER -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <h2 id="orderTitle">Order Produk</h2>
            <div style="margin: 20px 0;">
                <input type="text" id="targetId" placeholder="User ID / Target">
                <div style="background:var(--bg); padding:20px; border-radius:20px; border:1px solid var(--border); text-align:center;">
                    <img id="qrisImg" src="" style="width:200px; border-radius:15px; margin-bottom:15px;">
                    <h2 id="finalPrice" style="color:var(--primary)">Rp 0</h2>
                </div>
            </div>
            <button class="btn-main" onclick="confirmOrder()">Bayar & Konfirmasi WA</button>
            <button class="btn-main" style="background:none; color:var(--text-muted); margin-top:10px;" onclick="closeModal('orderModal')">Batal</button>
        </div>
    </div>

    <!-- MODAL TRACKING -->
    <div id="trackModal" class="modal">
        <div class="modal-content">
            <h2>Lacak Pesanan</h2>
            <input type="text" id="trackInput" placeholder="Masukkan User ID Game">
            <button class="btn-main" onclick="trackOrder()">Cek Status</button>
            <div id="trackRes" style="margin-top:20px;"></div>
            <button class="btn-main" style="background:none; color:var(--text-muted); margin-top:10px;" onclick="closeModal('trackModal')">Tutup</button>
        </div>
    </div>

    <!-- ADMIN PANEL -->
    <button class="admin-float" onclick="openAdmin()"><i class="fas fa-shield-alt"></i></button>

    <div id="adminModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h2>Admin Cloud Control</h2>
            <div style="margin-top: 20px; max-height: 60vh; overflow-y: auto;">
                <label>Update Overlay Pengumuman:</label>
                <input type="text" id="ovTitleNew" placeholder="Judul Pengumuman">
                <input type="text" id="ovDescNew" placeholder="Deskripsi Singkat">
                <input type="file" id="ovImgNew" accept="image/*">
                <button class="btn-main" style="margin-bottom:20px" onclick="updateOverlay()">Update Overlay</button>
                
                <hr style="margin:20px 0;">
                
                <label>Tambah Produk:</label>
                <input type="text" id="pName" placeholder="Nama Produk">
                <input type="number" id="pPrice" placeholder="Harga">
                <input type="file" id="pImg" accept="image/*">
                <button class="btn-main" onclick="addProduct()">Simpan Produk</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
        AOS.init();

        const SB_URL = "https://supjhhgcnqqxdkzsvykq.supabase.co";
        const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InN1cGpoaGdjbnFxeGRrenN2eWtxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk2NjczNDQsImV4cCI6MjA4NTI0MzM0NH0.UtP06HT6V8X5M_IY2BCixrz0VNwDsNAZiDK8NgSfcgw";
        const _supabase = supabase.createClient(SB_URL, SB_KEY);

        let products = [];
        let selectedIdx = null;

        async function init() {
            setLoad(true);
            try {
                // Load Products
                const { data: p } = await _supabase.from('products').select('*');
                products = p || [];
                renderGrid(products);

                // Load Settings (QRIS & Overlay)
                const { data: s } = await _supabase.from('settings').select('*');
                const qris = s.find(x => x.key === 'qris_image');
                const ovT = s.find(x => x.key === 'ov_title');
                const ovD = s.find(x => x.key === 'ov_desc');
                const ovI = s.find(x => x.key === 'ov_img');

                window.qrisUrl = qris ? qris.value : "";
                
                // Overlay Logic
                if (!sessionStorage.getItem('zenn_welcome')) {
                    document.getElementById('ovTitle').innerText = ovT ? ovT.value : "Welcome";
                    document.getElementById('ovDesc').innerText = ovD ? ovD.value : "Selamat Belanja!";
                    document.getElementById('ovImg').src = ovI ? ovI.value : "";
                    showOverlay();
                }
            } catch(e) {}
            setLoad(false);
        }

        function renderGrid(data) {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = data.map((p, i) => `
                <div class="card-prod" data-aos="fade-up">
                    <img src="${p.img}" class="card-img">
                    <div style="padding:20px">
                        <h3>${p.name}</h3>
                        <p class="price">Rp ${parseInt(p.price).toLocaleString()}</p>
                        <button class="btn-main" style="margin-top:15px" onclick="openOrder(${i})">Beli Sekarang</button>
                    </div>
                </div>
            `).join('');
        }

        function openOrder(idx) {
            selectedIdx = idx;
            const p = products[idx];
            document.getElementById('orderTitle').innerText = p.name;
            document.getElementById('finalPrice').innerText = `Rp ${parseInt(p.price).toLocaleString()}`;
            document.getElementById('qrisImg').src = window.qrisUrl;
            openModal('orderModal');
        }

        async function confirmOrder() {
            const target = document.getElementById('targetId').value;
            if(!target) return alert("Isi Target!");
            const p = products[selectedIdx];
            await _supabase.from('orders').insert([{ prod: p.name, target: target, price: p.price, status: 'Pending' }]);
            window.open(`https://wa.me/6285129226805?text=*ORDER BARU*%0AProduk: ${p.name}%0ATarget: ${target}`);
        }

        // Overlay & Admin
        function showOverlay() {
            const ov = document.getElementById('fullOverlay');
            ov.style.display = 'flex';
            setTimeout(() => ov.classList.add('active'), 50);
        }

        function closeOverlay() {
            const ov = document.getElementById('fullOverlay');
            ov.classList.remove('active');
            sessionStorage.setItem('zenn_welcome', 'true');
            setTimeout(() => ov.style.display = 'none', 500);
        }

        async function updateOverlay() {
            const t = document.getElementById('ovTitleNew').value;
            const d = document.getElementById('ovDescNew').value;
            const f = document.getElementById('ovImgNew').files[0];
            
            setLoad(true);
            if(t) await _supabase.from('settings').update({ value: t }).eq('key', 'ov_title');
            if(d) await _supabase.from('settings').update({ value: d }).eq('key', 'ov_desc');
            if(f) {
                const reader = new FileReader();
                reader.readAsDataURL(f);
                reader.onload = async () => {
                    await _supabase.from('settings').update({ value: reader.result }).eq('key', 'ov_img');
                    location.reload();
                };
            } else { location.reload(); }
        }

        // Utils
        function openAdmin() { if(prompt("Pass:") === "admin123") openModal('adminModal'); }
        function openModal(id) { document.getElementById(id).style.display = 'flex'; }
        function closeModal(id) { document.getElementById(id).style.display = 'none'; }
        function setLoad(s) { document.getElementById('loader').style.display = s ? 'flex' : 'none'; }
        function toggleTheme() {
            const b = document.body;
            const isDark = b.getAttribute('data-theme') === 'dark';
            b.setAttribute('data-theme', isDark ? 'light' : 'dark');
            document.getElementById('themeIcon').className = isDark ? 'fas fa-moon' : 'fas fa-sun';
        }

        window.onload = init;
    </script>
</body>
</html>
